<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>اختبار</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static', filename='style-Quiz.css') }}"
    />
    <link rel="icon" href="logo-azura.svg" />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Tajawal:wght@200;300;400;500;700;800;900&display=swap");
      body {
        direction: rtl;
        text-align: right;
        font-family: Tajawal;
      }
      .text-center {
        text-align: center;
      }
      .float-right {
        float: left;
      }
      .form-container label {
        text-align: right;
      }
      .form-check-label {
        margin-right: 20px;
      }
    </style>
    <script>
      function startTimer(duration, display, form) {
        var timer = duration,
          minutes,
          seconds;
        var countdown = setInterval(function () {
          minutes = parseInt(timer / 60, 10);
          seconds = parseInt(timer % 60, 10);

          minutes = minutes < 10 ? "0" + minutes : minutes;
          seconds = seconds < 10 ? "0" + seconds : seconds;

          display.textContent = minutes + ":" + seconds;

          if (--timer < 0) {
            clearInterval(countdown);
            form.submit();
          }
        }, 1000);
      }

      window.onload = function () {
        var startTimeStr = "{{ start_time }}";
        if (!startTimeStr) {
          console.error("Start time is not defined.");
          return;
        }

        var startTime = new Date(startTimeStr).getTime();
        if (isNaN(startTime)) {
          console.error("Invalid start time:", startTimeStr);
          return;
        }

        var currentTime = new Date().getTime();
        var elapsedTime = Math.floor((currentTime - startTime) / 1000);
        var quizDuration = 60 * 20; // 20 minutes in seconds
        var remainingTime = quizDuration - elapsedTime;

        console.log("Start Time (UTC):", new Date(startTime));
        console.log("Current Time:", new Date(currentTime));
        console.log("Elapsed Time (seconds):", elapsedTime);
        console.log("Remaining Time (seconds):", remainingTime);

        // Adjust this condition to ensure you see the form before it submits
        if (remainingTime <= 0) {
          document.querySelector("#quiz-form").submit();
        } else {
          var display = document.querySelector("#time");
          var form = document.querySelector("#quiz-form");
          startTimer(remainingTime, display, form);
        }
      };
    </script>
  </head>
  <body>
    <div class="jumbotron text-center">
      <img
        src="{{ url_for('static', filename='logo-azura.svg') }}"
        alt="logo-azura"
        class="float-right"
        id="logo"
      />
      <h1>تدريب الموظفين</h1>
    </div>

    <div class="container mt-5">
      <h4
        style="
          margin-bottom: 5%;
          text-align: center;
          font-family: Tajawal;
          color: snow;
        "
      >
        يرجى إدخال معلوماتك الشخصية ووضع العلامات على الإجابات
      </h4>
      <p>
        <strong><span id="time">20:00</span>: الوقت المتبقي</strong>
      </p>
      <form
        id="quiz-form"
        action="{{ url_for('auth.submit_quiz', quiz_id=quiz.id) }}"
        method="post"
        class="form-container border-form"
      >
        <div class="container" id="questions">
          {% for question in quiz.questions %}
          <div class="mb-3">
            <p><strong>{{ question.title }}</strong></p>
            {% for option in question.options %}
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                name="question_{{ question.id }}"
                value="{{ option.id }}"
              />
              <label class="form-check-label"> {{ option.text }} </label>
            </div>
            {% endfor %}
          </div>
          {% endfor %}
        </div>
        <button type="submit" class="submit-button">إرسال</button>
      </form>
    </div>
    <div style="height: 50px"></div>
  </body>
</html>
